{"paragraphs":[{"text":"%md\n## Creation of RDD from Data\nDans ce notebook nous allons charger les données dans des RDD","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Creation of RDD from Data</h2>\n<p>Dans ce notebook nous allons charger les données dans des RDD</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1548146032651_1702778138","id":"20181212-102323_67420128","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:238"},{"text":"%spark.dep\nz.load(\"com.amazonaws:aws-java-sdk:1.3.10\")","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@167e0a77\n"}]},"apps":[],"jobName":"paragraph_1548146032660_-1147420320","id":"20190121-173833_1225419807","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:239"},{"text":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nimport org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\nimport org.apache.spark.sql.functions.{col, min, max, mean, var_pop, count}\nimport java.io.File\nimport scala.io.Source.{fromFile}\nimport java.net.{HttpURLConnection, URL}\nimport scala.language.postfixOps\nimport scala.sys.process._","user":"anonymous","dateUpdated":"2019-01-22T08:34:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nimport org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\nimport org.apache.spark.sql.functions.{col, min, max, mean, var_pop, count}\nimport java.io.File\nimport scala.io.Source.fromFile\nimport java.net.{HttpURLConnection, URL}\nimport scala.language.postfixOps\nimport scala.sys.process._\n"}]},"apps":[],"jobName":"paragraph_1548146032661_127606201","id":"20190121-180038_1381998713","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:240","dateFinished":"2019-01-22T08:34:53+0000","dateStarted":"2019-01-22T08:34:00+0000"},{"text":"val bucket_name = \"du-weijia-telecom-gdelt2018\"\nval AWS_ID = \"AKIAJOZH2VNBCRDJMTFA\" //(1) ID du fichier credentials\nval AWS_KEY = \"dg0JP7o/ycrH566aQpLGmzouqqkpQn2p099Inmow\" //(2) Secret du fichier credentials\nval awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) \nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) \nsc.hadoopConfiguration.set(\"fs.s3a.connection.maximum\",\"100000\")","user":"anonymous","dateUpdated":"2019-01-22T08:34:57+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bucket_name: String = du-weijia-telecom-gdelt2018\nAWS_ID: String = AKIAJOZH2VNBCRDJMTFA\nAWS_KEY: String = dg0JP7o/ycrH566aQpLGmzouqqkpQn2p099Inmow\nwarning: there was one deprecation warning; re-run with -deprecation for details\nawsClient: com.amazonaws.services.s3.AmazonS3Client = com.amazonaws.services.s3.AmazonS3Client@9308c8b\n"}]},"apps":[],"jobName":"paragraph_1548146032661_-852914271","id":"20171217-230735_1688540039","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:241","dateFinished":"2019-01-22T08:35:00+0000","dateStarted":"2019-01-22T08:34:57+0000"},{"text":"%md Les fichiers sont stockés compressés, on a besoin d'un bout de code pour les décompresser en parallel sur les workers au fur et a mesure qu'on les lit depuis S3:","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Les fichiers sont stockés compressés, on a besoin d&rsquo;un bout de code pour les décompresser en parallel sur les workers au fur et a mesure qu&rsquo;on les lit depuis S3:</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1548146032662_1924108038","id":"20181212-102329_808049084","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:242"},{"text":"def fileDownloader(urlOfFileToDownload: String, file: File) = {\n    val parentDirName = new File(file.getParent())\n    if (! parentDirName.exists()){\n        parentDirName.mkdirs();\n    }\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n    if(connection.getResponseCode >= 400){\n        println(\"error\")\n    }\n    else {\n        url #> file !!\n    }\n}","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"fileDownloader: (urlOfFileToDownload: String, file: java.io.File)Any\n"}]},"apps":[],"jobName":"paragraph_1548146032663_-627077184","id":"20190121-181413_1774031819","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:243"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548148962708_-1977556441","id":"20190122-092242_1695948710","dateCreated":"2019-01-22T09:22:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2199","text":"def RDDDownloader(fileName: String): org.apache.spark.rdd.RDD[String] = \n{\n    val resultRDD = sc.binaryFiles(fileName). // charger quelques fichers via une regex\n    flatMap {  // decompresser les fichiers\n        case (name: String, content: PortableDataStream) =>\n            try {\n                val zis = new ZipInputStream(content.open)\n                Stream.continually(zis.getNextEntry).\n                    takeWhile(_ != null).\n                    flatMap { _ =>\n                        val br = new BufferedReader(new InputStreamReader(zis))\n                        Stream.continually(br.readLine()).takeWhile(_ != null)\n                    }\n            } catch {\n                case e : Exception =>\n                None\n            }\n    }\n    return resultRDD\n}","dateUpdated":"2019-01-22T09:25:39+0000","dateFinished":"2019-01-22T09:25:40+0000","dateStarted":"2019-01-22T09:25:39+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"RDDDownloader: (fileName: String)org.apache.spark.rdd.RDD[String]\n"}]}},{"text":"val local_path = System.getProperty(\"user.dir\")\n\nfileDownloader(\"https://www.gdeltproject.org/data/lookups/CAMEO.knowngroup.txt\", new File(local_path + \"/CAMEO.knowngroup.txt\"))\nnew AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY)).putObject(bucket_name, \"CAMEO.knowngroup.txt\", local_path + \"/CAMEO.knowngroup.txt\")\n\nfileDownloader(\"https://www.gdeltproject.org/data/lookups/CAMEO.country.txt\", new File(local_path + \"/CAMEO.country.txt\"))\nnew AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY)).putObject(bucket_name, \"CAMEO.country.txt\", local_path + \"/CAMEO.country.txt\")","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"local_path: String = /mnt/var/lib/zeppelin\nres20: Any = \"\"\nwarning: there was one deprecation warning; re-run with -deprecation for details\nres21: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@1bd6dba0\nres22: Any = \"\"\nwarning: there was one deprecation warning; re-run with -deprecation for details\nres23: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@4028ce08\n"}]},"apps":[],"jobName":"paragraph_1548146032664_-678364231","id":"20190121-181435_2076071535","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:245"},{"text":"// Export Events\nval eventsRDD = RDDDownloader(\"s3a://\" + bucket_name + \"/events/*.export.CSV.zip\")\nval mentionsRDD = RDDDownloader(\"s3a://\" + bucket_name + \"/mentions/*.CSV.zip\")","user":"anonymous","dateUpdated":"2019-01-22T09:25:49+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"eventsRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[14] at flatMap at <console>:43\nmentionsRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[16] at flatMap at <console>:43\n"}]},"apps":[],"jobName":"paragraph_1548146032664_-681188836","id":"20190121-175851_504012144","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:246","dateFinished":"2019-01-22T09:25:50+0000","dateStarted":"2019-01-22T09:25:49+0000"},{"text":"val cachedEvents = eventsRDD.cache // RDD\nval cachedMentions = mentionsRDD.cache","user":"anonymous","dateUpdated":"2019-01-22T09:25:53+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cachedEvents: eventsRDD.type = MapPartitionsRDD[14] at flatMap at <console>:43\ncachedMentions: mentionsRDD.type = MapPartitionsRDD[16] at flatMap at <console>:43\n"}]},"apps":[],"jobName":"paragraph_1548146032665_1736205123","id":"20190107-102856_946427568","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:247","dateFinished":"2019-01-22T09:25:54+0000","dateStarted":"2019-01-22T09:25:53+0000"},{"text":"case class Event(GLOBALEVENTID: Int,\nSQLDATE: Int,\nMonthYear: Int,\nYear: Int,\nFractionDate: Double,\nActor1Code: String,\nActor1Name: String,\nActor1CountryCode: String,\nActor1KnownGroupCode: String,\nActor1EthnicCode: String,\nActor1Religion1Code: String,\nActor1Religion2Code: String,\nActor1Type1Code: String,\nActor1Type2Code: String,\nActor1Type3Code: String,\nActor2Code: String,\nActor2Name: String,\nActor2CountryCode: String,\nActor2KnownGroupCode: String,\nActor2EthnicCode: String,\nActor2Religion1Code: String,\nActor2Religion2Code: String,\nActor2Type1Code: String,\nActor2Type2Code: String,\nActor2Type3Code: String,\nIsRootEvent: Int,\nEventCode: String,\nEventBaseCode: String,\nEventRootCode: String,\nQuadClass: Int,\nGoldsteinScale: Double,\nNumMentions: Int,\nNumSources: Int,\nNumArticles: Int,\nAvgTone: Double,\nActor1Geo_Type: Int,\nActor1Geo_FullName: String,\nActor1Geo_CountryCode: String,\nActor1Geo_ADM1Code: String,\nActor1Geo_ADM2Code: String,\nActor1Geo_Lat: Double,\nActor1Geo_Long: Double,\nActor1Geo_FeatureID: String,\nActor2Geo_Type: Int,\nActor2Geo_FullName: String,\nActor2Geo_CountryCode: String,\nActor2Geo_ADM1Code: String,\nActor2Geo_ADM2Code: String,\nActor2Geo_Lat: Double,\nActor2Geo_Long: Double,\nActor2Geo_FeatureID: String,\nActionGeo_Type: Int,\nActionGeo_FullName: String,\nActionGeo_CountryCode: String,\nActionGeo_ADM1Code: String,\nActionGeo_ADM2Code: String,\nActionGeo_Lat: Double,\nActionGeo_Long: Double,\nActionGeo_FeatureID: String,\nDATEADDED: BigInt,\nSOURCEURL: String)","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Event\n"}]},"apps":[],"jobName":"paragraph_1548146032666_1342411341","id":"20190107-095023_1048093380","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:248"},{"text":"case class Mention(GLOBALEVENTID: Int,\nEventTimeDate: BigInt,\nMentionTimeDate: BigInt,\nMentionType: Int,\nMentionSourceName: String,\nMentionIdentifier: String,\nSentenceID: Int,\nActor1CharOffset: Int,\nActor2CharOffset: Int,\nActionCharOffset: Int,\nInRawText: Int,\nConfidence: Int,\nMentionDocLen: Int,\nMentionDocTone: Double,\nMentionDocTranslationInfo: String)//,\n//Extras: String)","user":"anonymous","dateUpdated":"2019-01-22T09:25:56+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Mention\n"}]},"apps":[],"jobName":"paragraph_1548146032666_-566392230","id":"20190109-085959_371186108","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:249","dateFinished":"2019-01-22T09:25:57+0000","dateStarted":"2019-01-22T09:25:56+0000"},{"text":"def toStrings(s : String): String = if (s.isEmpty) null else s\n\ndef toDouble(s : String): Double = {\n    if (s.isEmpty) 0  \n    else {\n        try {\n            s.toDouble\n        } catch {\n            case e: Exception => 0\n        }\n    }\n}\n\ndef toInt(s : String): Int = {\n    if (s.isEmpty) 0  \n    else {\n        try {\n            s.toInt\n        } catch {\n            case e: Exception => 0\n        }\n    }\n}\n\ndef toBigInt(s : String): BigInt = {\n    if (s.isEmpty) BigInt(0) \n    else {\n        try {\n            BigInt(s)\n        } catch {\n            case e: Exception => BigInt(0) \n        }\n    }\n}","user":"anonymous","dateUpdated":"2019-01-22T09:25:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"toStrings: (s: String)String\ntoDouble: (s: String)Double\ntoInt: (s: String)Int\ntoBigInt: (s: String)BigInt\n"}]},"apps":[],"jobName":"paragraph_1548146032667_410092538","id":"20190121-175531_232057282","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:250","dateFinished":"2019-01-22T09:26:01+0000","dateStarted":"2019-01-22T09:25:59+0000"},{"text":"var events = cachedEvents.map(_.split(\"\\t\")).filter(_.length==61).map(\n    e=> Event(\n        toInt(e(0)),toInt(e(1)),toInt(e(2)),toInt(e(3)),toDouble(e(4)),toStrings(e(5)),toStrings(e(6)),toStrings(e(7)),toStrings(e(8)),toStrings(e(9)),toStrings(e(10)),toStrings(e(11)),toStrings(e(12)),\n        toStrings(e(13)),toStrings(e(14)),toStrings(e(15)),toStrings(e(16)),toStrings(e(17)),toStrings(e(18)),toStrings(e(19)),toStrings(e(20)),toStrings(e(21)),toStrings(e(22)),toStrings(e(23)),toStrings(e(24)),\n        toInt(e(25)),toStrings(e(26)),toStrings(e(27)),toStrings(e(28)),toInt(e(29)),toDouble(e(30)),toInt(e(31)),toInt(e(32)),toInt(e(33)),toDouble(e(34)),toInt(e(35)),toStrings(e(36)),toStrings(e(37)),\n        toStrings(e(38)),toStrings(e(39)),toDouble(e(40)),toDouble(e(41)),toStrings(e(42)),toInt(e(43)),toStrings(e(44)),toStrings(e(45)),toStrings(e(46)),toStrings(e(47)),toDouble(e(48)),toDouble(e(49)),\n        toStrings(e(50)),toInt(e(51)),toStrings(e(52)),toStrings(e(53)),toStrings(e(54)),toStrings(e(55)),toDouble(e(56)),toDouble(e(57)),e(58),toBigInt(e(59)),toStrings(e(60)))\n\n).toDF()\n\nval group_transco = spark.read.\n    format(\"csv\").\n    option(\"header\", true).\n    option(\"delimiter\", \"\\t\").\n    load(\"s3n://\" + bucket_name + \"/CAMEO.knowngroup.txt\")\n    \nevents = events.join(group_transco, events(\"Actor1KnownGroupCode\")===group_transco(\"CODE\"), \"left\").withColumn(\"Actor1KnownGroupName\", col(\"LABEL\")).drop(df.columns: _*)\nevents = events.join(group_transco, events(\"Actor2KnownGroupCode\")===group_transco(\"CODE\"), \"left\").withColumn(\"Actor2KnownGroupName\", col(\"LABEL\")).drop(df.columns: _*)\n\nval country_transco = spark.read.\n    format(\"csv\").\n    option(\"header\", true).\n    option(\"delimiter\", \"\\t\").\n    load(\"s3n://\" + bucket_name + \"/CAMEO.country.txt\")\n    \nevents = events.join(country_transco, events(\"Actor1CountryCode\")===country_transco(\"CODE\"), \"left\").withColumn(\"Actor1CountryName\", col(\"LABEL\")).drop(df.columns: _*)\nevents = events.join(country_transco, events(\"Actor2CountryCode\")===country_transco(\"CODE\"), \"left\").withColumn(\"Actor2CountryName\", col(\"LABEL\")).drop(df.columns: _*)","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"toStrings: (s: String)String\ntoDouble: (s: String)Double\ntoInt: (s: String)Int\ntoBigInt: (s: String)BigInt\nevents: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, SQLDATE: int ... 59 more fields]\ngroup_transco: org.apache.spark.sql.DataFrame = [CODE: string, LABEL: string]\nevents: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, SQLDATE: int ... 60 more fields]\nevents: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, SQLDATE: int ... 61 more fields]\ncountry_transco: org.apache.spark.sql.DataFrame = [CODE: string, LABEL: string]\nevents: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, SQLDATE: int ... 62 more fields]\nevents: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, SQLDATE: int ... 63 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548146032668_1651703105","id":"20190107-095130_1656507834","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:251"},{"text":"val mentions = \ncachedMentions.map(_.split(\"\\t\")).filter(_.length==15).map(\n    e=> Mention(\n        toInt(e(0)),toBigInt(e(1)),toBigInt(e(2)),toInt(e(3)),toStrings(e(4)),toStrings(e(5)),toInt(e(6)),toInt(e(7)),toInt(e(8)),toInt(e(9)),toInt(e(10)),toInt(e(11)),toInt(e(12)),toDouble(e(13)),toStrings(e(14)))\n\n).toDF()","user":"anonymous","dateUpdated":"2019-01-22T09:26:12+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentions: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, EventTimeDate: decimal(38,0) ... 13 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548146032669_529134920","id":"20190109-093906_657341265","dateCreated":"2019-01-22T08:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:252","dateFinished":"2019-01-22T09:26:13+0000","dateStarted":"2019-01-22T09:26:12+0000"},{"text":"mentions.count()","user":"anonymous","dateUpdated":"2019-01-22T09:26:19+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"org.apache.spark.SparkException: Job aborted due to stage failure: Task 5 in stage 2.0 failed 4 times, most recent failure: Lost task 5.3 in stage 2.0 (TID 127, ip-172-31-47-123.eu-west-1.compute.internal, executor 13): ExecutorLostFailure (executor 13 exited caused by one of the running tasks) Reason: Container marked as failed: container_1548145873041_0001_01_000014 on host: ip-172-31-47-123.eu-west-1.compute.internal. Exit status: 137. Diagnostics: Container killed on request. Exit code is 137\nContainer exited with a non-zero exit code 137\nKilled by external signal\n\nDriver stacktrace:\n  at org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:2039)\n  at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:2027)\n  at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:2026)\n  at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n  at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)\n  at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2026)\n  at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:966)\n  at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:966)\n  at scala.Option.foreach(Option.scala:257)\n  at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:966)\n  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2260)\n  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2209)\n  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2198)\n  at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)\n  at org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:777)\n  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2061)\n  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2082)\n  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2101)\n  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2126)\n  at org.apache.spark.rdd.RDD$$anonfun$collect$1.apply(RDD.scala:945)\n  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)\n  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)\n  at org.apache.spark.rdd.RDD.withScope(RDD.scala:363)\n  at org.apache.spark.rdd.RDD.collect(RDD.scala:944)\n  at org.apache.spark.sql.execution.SparkPlan.executeCollect(SparkPlan.scala:299)\n  at org.apache.spark.sql.Dataset$$anonfun$count$1.apply(Dataset.scala:2831)\n  at org.apache.spark.sql.Dataset$$anonfun$count$1.apply(Dataset.scala:2830)\n  at org.apache.spark.sql.Dataset$$anonfun$53.apply(Dataset.scala:3365)\n  at org.apache.spark.sql.execution.SQLExecution$$anonfun$withNewExecutionId$1.apply(SQLExecution.scala:78)\n  at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:125)\n  at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:73)\n  at org.apache.spark.sql.Dataset.withAction(Dataset.scala:3364)\n  at org.apache.spark.sql.Dataset.count(Dataset.scala:2830)\n  ... 54 elided\n"}]},"apps":[],"jobName":"paragraph_1548146032669_-1573635349","id":"20190121-175558_1688307728","dateCreated":"2019-01-22T08:33:52+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:253","dateFinished":"2019-01-22T10:11:21+0000","dateStarted":"2019-01-22T09:26:19+0000","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-41-89.eu-west-1.compute.internal:4040/jobs/job?id=1"],"interpreterSettingId":"spark"}}},{"text":"val tableA = events.filter(\"Actor1Code is not null or Actor1CountryName is not null or Actor1KnownGroupName is not null\").select(\"SQLDATE\", \"Actor1Code\", \"Actor1CountryName\", \"Actor1KnownGroupName\", \"GLOBALEVENTID\")\n\nval tableM = mentions.select(\"GLOBALEVENTID\", \"MentionDocTone\")\n\nval actor_final = tableA.\n    join(tableB, \"GLOBALEVENTID\").\n    groupBy(\"GLOBALEVENTID\").\n    agg(max(col(\"SQLDATE\")),max(col(\"Actor1Code\")),max(col(\"Actor1CountryName\")),max(col(\"Actor1KnownGroupName\")),var_pop(col(\"MentionDocTone\")), count(col(\"GLOBALEVENTID\"))).\n    toDF(\"GLOBALEVENTID\",\"DATE\",\"ACTOR\",\"COUNTRY\",\"ORGANIZATION\",\"VARIANCE\",\"NB_ARTICLE\").\n    select(\"DATE\",\"ACTOR\",\"COUNTRY\",\"ORGANIZATION\",\"GLOBALEVENTID\", \"VARIANCE\",\"NB_ARTICLE\").\n    sort(asc(\"DATE\"), asc(\"ACTOR\"), asc(\"COUNTRY\"), asc(\"ORGANIZATION\"), asc(\"GLOBALEVENTID\"))","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tableA: org.apache.spark.sql.DataFrame = [SQLDATE: int, Actor1Code: string ... 3 more fields]\ntableM: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: int, MentionDocTone: double]\nactor_final: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [DATE: int, ACTOR: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548146032670_-1870003733","id":"20190120-141203_1996331037","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:254"},{"text":"actor_final.show()","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+------+--------------------+------------+-------------+--------------------+----------+\n|    DATE| ACTOR|             COUNTRY|ORGANIZATION|GLOBALEVENTID|            VARIANCE|NB_ARTICLE|\n+--------+------+--------------------+------------+-------------+--------------------+----------+\n|20170218|   BUS|                null|        null|    731960710|                 0.0|         1|\n|20170218|   BUS|                null|        null|    731962367|                 0.0|         1|\n|20170218|   BUS|                null|        null|    731962368|                 0.0|         1|\n|20170218|   BUS|                null|        null|    731964204|                 0.0|         1|\n|20170218|   CHN|               China|        null|    731960711|                 0.0|         1|\n|20170218|   GOV|                null|        null|    731964205|0.016999395602734182|         3|\n|20170218|   GOV|                null|        null|    731967697|                 0.0|         1|\n|20170218|   LAB|                null|        null|    731962369|                 0.0|         1|\n|20170218|MNCKOR|         South Korea|        null|    731967698|                 0.0|         1|\n|20170218|   RUS|              Russia|        null|    731960712|                 0.0|         1|\n|20170219|   AFG|         Afghanistan|        null|    732045994| 0.08621323853451052|         3|\n|20170219|AGOMED|              Angola|        null|    732045995|                 0.0|         1|\n|20170219|   ARE|United Arab Emirates|        null|    732148677|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    731990663|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    732037434|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    732113544|                 0.0|         2|\n|20170219|   ARG|           Argentina|        null|    732187741|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    732215473|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    732215474|                 0.0|         1|\n|20170219|   ARG|           Argentina|        null|    732215475|                 0.0|         1|\n+--------+------+--------------------+------------+-------------+--------------------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548146032671_436678733","id":"20190120-142548_1909073270","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"text":"// Partition Key : Jour, Mois, Année (SQLDATE)\n// Clustering Column(s) : ACTOR, COUNTRY, ORGANIZATION, GLOBALEVENTID\n// Value(s) : VARIANCE, NB_ARTICLE\n\n// SELECT ACTOR, SUM(NB_ARTICLE * VARIANCE)/SUM(NB_ARTICLE) AS MEAN FROM TABLE WHERE ACTOR  GROUP BY ACTOR ORDER BY MEAN DESC","user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548146032672_-102965162","id":"20190113-134614_1085664168","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:256"},{"user":"anonymous","dateUpdated":"2019-01-22T08:33:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548146032672_-232769482","id":"20190120-164044_87848048","dateCreated":"2019-01-22T08:33:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:257"}],"name":"gdeltDatasetEngineering_PP","id":"2E34YRTK7","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}